# Newey-West调整协方差

我们一般在估计样本协方差的时候，往往是直接将一个时间窗口内的所有样本拿过来，利用自己和自己的转置做点乘得到。假设样本为$X\in \mathbb{R}^{N\times T}$，其中$N$表示样本数量，$T$表示样本的长度。假设每个样本已经去均值化了，那么协方差矩阵就是
$$
V=\frac{1}{T} X X^T
$$
其中，$V\in \mathbb{R}^{N\times N}$。当时间窗口增大时，估计出的$V$会更加靠近真实值（一致估计）。但是由于时间序列数据存在自相关性，因此估计出的协方差并不满足逼近真实值的性质，需要考虑自协方差的影响。

定义自协方差
$$
\Gamma_i=\frac{1}{T}X_{:,1:T-i}X^T_{:,1+i:T}
$$
其中$X_{:,1:T-i}$表示了矩阵$X$的第1列到第$T-i$列的部分，那么$X_{:,1+i:T}$表示矩阵$X$的第$1+i$列到$T$列部分。那么$\Gamma_i$表示样本滞后$i$个时间点的自协方差。

我们发现$\Gamma_i$不是一个对称矩阵。由于协方差矩阵要求是一个对称矩阵， 因此我们在使用中会用$\Gamma_i+\Gamma_i^T$表示。

我们发现当$i=0$的时候，$\Gamma_0$就是原本的样本协方差矩阵，我们就用$\Gamma_0$代表样本协方差矩阵。

进而我们可以用自协方差矩阵去调整样本协方差矩阵。
$$
V = \Gamma_0 + \sum_{i=1}^q{(\Gamma_i+\Gamma_i^T)}
$$
但是由于协方差矩阵必须是半正定的，因此增加了Bartlett权重系数
$$
w_i=1-\frac{i}{1+q}
$$
此时的协方差矩阵为
$$
V = \Gamma_0 + \sum_{i=1}^q{w_i(\Gamma_i+\Gamma_i^T)}
$$


